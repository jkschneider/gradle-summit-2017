{"paragraphs":[{"text":"%dep\nz.addRepo(\"jcenter\").url(\"https://jcenter.bintray.com\")\nz.addRepo(\"bintray\").url(\"https://dl.bintray.com/jkschneider/maven\")\nz.load(\"com.spotify:spark-bigquery_2.11:0.2.0\")\nz.load(\"com.netflix.devinsight.rewrite:rewrite-core:jar:jdkbundle:1.2.5\")\nz.load(\"org.scalaj:scalaj-http_2.11:2.3.0\")\nz.load(\"io.jschneider:rewrite-guava:0.2.0\")","dateUpdated":"2017-06-19T18:22:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","tableHide":true,"graph":{"mode":"table","height":90,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737434_-1356057334","id":"20170615-173110_1105341905","result":{"code":"SUCCESS","type":"TEXT","msg":"DepInterpreter(%dep) deprecated. Add repository through GUI interpreter menu instead.\nDepInterpreter(%dep) deprecated. Add repository through GUI interpreter menu instead.\nDepInterpreter(%dep) deprecated. Load dependency through GUI interpreter menu instead.\nDepInterpreter(%dep) deprecated. Load dependency through GUI interpreter menu instead.\nDepInterpreter(%dep) deprecated. Load dependency through GUI interpreter menu instead.\nDepInterpreter(%dep) deprecated. Load dependency through GUI interpreter menu instead.\nres0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@1455eead\n"},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T18:22:49+0000","dateFinished":"2017-06-19T18:22:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7744"},{"title":"Imports","text":"import collection.JavaConverters._\nimport com.netflix.rewrite.parse.OracleJdkParser\nimport com.netflix.rewrite.ast._\nimport com.netflix.rewrite.ast.visitor.AstVisitor\nimport java.nio.file.Paths\nimport scalaj.http.Http\nimport scala.util.Try\nimport io.jschneider.gradlesummit.rewrite.RewriteGuava","dateUpdated":"2017-06-19T18:23:20+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497895745177_-1261052449","id":"20170619-180905_1572771461","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport collection.JavaConverters._\n\nimport com.netflix.rewrite.parse.OracleJdkParser\n\nimport com.netflix.rewrite.ast._\n\nimport com.netflix.rewrite.ast.visitor.AstVisitor\n\nimport java.nio.file.Paths\n\nimport scalaj.http.Http\n\nimport scala.util.Try\n\nimport io.jschneider.gradlesummit.rewrite.RewriteGuava\n"},"dateCreated":"2017-06-19T18:09:05+0000","dateStarted":"2017-06-19T18:23:01+0000","dateFinished":"2017-06-19T18:23:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7745"},{"title":"This is the Guava jar we will use in AST parsing","text":"sc.addFile(\"http://repo1.maven.org/maven2/com/google/guava/guava/18.0/guava-18.0.jar\")","dateUpdated":"2017-06-19T18:23:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737436_-1358365828","id":"20170615-214744_1824207992","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T18:23:23+0000","dateFinished":"2017-06-19T18:23:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7746"},{"title":"Pull all the Java sources out of BigQuery","text":"import com.spotify.spark.bigquery._\n\nval sources = sqlContext.bigQuerySelect(\"SELECT * FROM [cf-sandbox-jschneider:gradle_summit.java_file_contents_guava]\")\n    .rdd\n    .repartition(2000)","dateUpdated":"2017-06-19T18:23:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737436_-1358365828","id":"20170615-171334_393033523","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport com.spotify.spark.bigquery._\n\nsources: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[7] at rdd at <console>:43\n"},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T18:23:26+0000","dateFinished":"2017-06-19T18:24:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7747"},{"title":"Parse Java sources into ASTs with Rewrite","text":"val refactored = sources.flatMap { case org.apache.spark.sql.Row(repo: String, path: String, source: String) => {\n    val start = System.nanoTime()\n    \n    // attempt to parse the source file with Rewrite, may fail parsing if the source is badly mangled\n    val parseResult = Try(new OracleJdkParser(List(Paths.get(org.apache.spark.SparkFiles.get(\"guava-18.0.jar\"))).asJava).parse(source).asInstanceOf[Tr.CompilationUnit])\n    \n    Try(Http(s\"http://cluster-1-m:8101/api/timer/parse/${System.nanoTime()-start}\").postData(\"\").execute()) // metrics!\n    \n    parseResult.map(cu => (\n        repo,\n        path,\n        RewriteGuava.listIssues(cu).asScala,\n        RewriteGuava.refactor(cu, path)\n    )).toOption\n}}.coalesce(60)\nrefactored.cache","dateUpdated":"2017-06-19T19:46:19+0000","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737436_-1358365828","id":"20170615-221626_202043697","result":{"code":"SUCCESS","type":"TEXT","msg":"\nrefactored: org.apache.spark.rdd.RDD[(String, String, scala.collection.mutable.Buffer[String], String)] = CoalescedRDD[73] at coalesce at <console>:58\n\nres29: refactored.type = CoalescedRDD[73] at coalesce at <console>:58\n"},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T19:46:19+0000","dateFinished":"2017-06-19T19:46:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7748","focus":true},{"text":"refactored.flatMap(row => row._3.map(issue => (row._1, row._2, issue))).toDF(\"repo\", \"path\", \"issue\").registerTempTable(\"issues\")","dateUpdated":"2017-06-19T19:46:24+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497896158039_1690349262","id":"20170619-181558_1650072826","result":{"code":"SUCCESS","type":"TEXT","msg":"\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"},"dateCreated":"2017-06-19T18:15:58+0000","dateStarted":"2017-06-19T19:46:24+0000","dateFinished":"2017-06-19T19:46:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7749","title":"Create table with information about issues","focus":true},{"text":"refactored\n  .filter(row => !row._4.isEmpty) // non-empty diffs\n  .map(row => (row._1, row._4)) // cut down to PairRDD of (repo, diff) \n  .reduceByKey((diff1, diff2) => \"$diff1\\n\\n$diff2\")\n  .toDF(\"repo\", \"diff\")\n  .saveAsBigQueryTable(\"cf-sandbox-jschneider:gradle_summit.diffs\")","dateUpdated":"2017-06-19T19:41:46+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497897554091_-354995625","id":"20170619-183914_381769728","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2017-06-19T18:39:14+0000","dateStarted":"2017-06-19T19:41:46+0000","dateFinished":"2017-06-19T19:42:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7750","focus":true},{"text":"%sql\nselect issue, count(1) value\nfrom issues\ngroup by issue\norder by issue","dateUpdated":"2017-06-19T19:46:32+0000","config":{"colWidth":8,"editorMode":"ace/mode/sql","graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"issue","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"issue","index":0,"aggr":"sum"},"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737437_-1358750577","id":"20170616-052725_1316908264","result":{"code":"SUCCESS","type":"TABLE","msg":"issue\tvalue\nIterators.emptyIterator\t1\nObjects.toStringHelper\t7\n","comment":"","msgTable":[[{"key":"value","value":"Iterators.emptyIterator"},{"key":"value","value":"1"}],[{"value":"Objects.toStringHelper"},{"value":"7"}]],"columnNames":[{"name":"issue","index":0,"aggr":"sum"},{"name":"value","index":1,"aggr":"sum"}],"rows":[["Iterators.emptyIterator","1"],["Objects.toStringHelper","7"]]},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T19:46:32+0000","dateFinished":"2017-06-19T19:47:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7751","focus":true},{"title":"How many sources did we successfully parse?","text":"refactored.count","dateUpdated":"2017-06-19T18:38:55+0000","config":{"colWidth":4,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497807737437_-1358750577","id":"20170616-012252_1288931189","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres22: Long = 484\n"},"dateCreated":"2017-06-18T17:42:17+0000","dateStarted":"2017-06-19T18:38:55+0000","dateFinished":"2017-06-19T18:38:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7752"},{"text":"","dateUpdated":"2017-06-19T18:45:44+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1497897933934_-1068216106","id":"20170619-184533_779408910","dateCreated":"2017-06-19T18:45:33+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7754"}],"name":"Guava","id":"2CKRQ6R5J","angularObjects":{"2CHZMMX56:shared_process":[],"2CNQW446D:shared_process":[],"2CKG22YFM:shared_process":[],"2CJWBR6K8:shared_process":[],"2CKS2PYZQ:shared_process":[],"2CK6627P8:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}